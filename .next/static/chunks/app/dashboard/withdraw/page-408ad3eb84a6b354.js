(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{3716:(e,t,a)=>{Promise.resolve().then(a.bind(a,4199))},4199:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),l=a(2115),s=a(2619),n=a.n(s),i=a(6648);function d(){let[e,t]=(0,l.useState)(""),[a,s]=(0,l.useState)(""),[d,u]=(0,l.useState)(null),[o,c]=(0,l.useState)(!1),[p,x]=(0,l.useState)(null),m=(0,i.U)();async function h(t){t.preventDefault();let r=parseFloat(e);if(r<50||r>7e4)return void x({type:"err",text:"Amount must be between KES 50 and 70,000"});if(null!=d&&r>d)return void x({type:"err",text:"Insufficient balance"});c(!0),x(null);try{let e=await fetch("/api/withdraw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:r,phone:a.replace(/\D/g,"")})}),t=await e.json();if(!e.ok)return void x({type:"err",text:t.error||"Withdrawal failed"});x({type:"ok",text:"Withdrawal requested. You will receive funds via M-Pesa."}),u(e=>null!=e?e-r:null)}finally{c(!1)}}return(0,l.useEffect)(()=>{(async()=>{var e;let{data:{user:t}}=await m.auth.getUser();if(!t)return;let{data:a}=await m.from("wallets").select("balance_kes").eq("user_id",t.id).single();u(null!=(e=null==a?void 0:a.balance_kes)?e:0)})()},[m]),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white mb-4",children:"Withdraw to M-Pesa"}),null!=d&&(0,r.jsxs)("p",{className:"text-gray-400 mb-4",children:["Available: KES ",d.toLocaleString()]}),(0,r.jsxs)("div",{className:"card-apex max-w-md",children:[(0,r.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Phone (254...)"}),(0,r.jsx)("input",{type:"tel",value:a,onChange:e=>s(e.target.value),placeholder:"254712345678",required:!0,className:"w-full bg-apex-muted border border-apex-primary/30 rounded-lg px-3 py-2 text-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-300 mb-1",children:"Amount (KES)"}),(0,r.jsx)("input",{type:"number",min:50,max:7e4,step:10,value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full bg-apex-muted border border-apex-primary/30 rounded-lg px-3 py-2 text-white"})]}),p&&(0,r.jsx)("p",{className:"err"===p.type?"text-red-400":"text-apex-primary",children:p.text}),(0,r.jsx)("button",{type:"submit",disabled:o,className:"w-full btn-primary py-3 rounded-xl disabled:opacity-50",children:o?"Processing...":"Withdraw"})]}),(0,r.jsx)("p",{className:"mt-4 text-gray-500 text-sm",children:(0,r.jsx)(n(),{href:"/dashboard",className:"text-apex-primary hover:underline",children:"Back to dashboard"})})]})]})}},6648:(e,t,a)=>{"use strict";a.d(t,{U:()=>l});var r=a(5417);function l(){return(0,r.createBrowserClient)("your_supabase_url","your_supabase_anon_key")}}},e=>{e.O(0,[619,417,441,255,358],()=>e(e.s=3716)),_N_E=e.O()}]);